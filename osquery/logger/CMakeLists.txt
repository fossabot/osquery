file(GLOB OSQUERY_LOGGER "*.cpp")
ADD_OSQUERY_LIBRARY(TRUE osquery_logger ${OSQUERY_LOGGER})

file(GLOB OSQUERY_LOGGER_PLUGINS "plugins/*.cpp")
ADD_OSQUERY_LIBRARY(FALSE osquery_logger_plugins ${OSQUERY_LOGGER_PLUGINS})
ADD_OSQUERY_LINK_ADDITIONAL("aws-cpp-sdk-kinesis")
ADD_OSQUERY_LINK_ADDITIONAL("aws-cpp-sdk-iam")
ADD_OSQUERY_LINK_ADDITIONAL("aws-cpp-sdk-core")
if(LINUX)
  # This is psycho. There must be a way we can do better.
  ADD_OSQUERY_LINK_ADDITIONAL("curl")
  ADD_OSQUERY_LINK_ADDITIONAL("idn")
  ADD_OSQUERY_LINK_ADDITIONAL("crypto")
  ADD_OSQUERY_LINK_ADDITIONAL("lber")
  ADD_OSQUERY_LINK_ADDITIONAL("tasn1")
  ADD_OSQUERY_LINK_ADDITIONAL("ldap")
  ADD_OSQUERY_LINK_ADDITIONAL("rt")
  ADD_OSQUERY_LINK_ADDITIONAL("gssapi_krb5")
  ADD_OSQUERY_LINK_ADDITIONAL("ssl")
  ADD_OSQUERY_LINK_ADDITIONAL("crypto")
  ADD_OSQUERY_LINK_ADDITIONAL("z")
  ADD_OSQUERY_LINK_ADDITIONAL("rtmp")
  ADD_OSQUERY_LINK_ADDITIONAL("z")
  ADD_OSQUERY_LINK_ADDITIONAL("gnutls")
  ADD_OSQUERY_LINK_ADDITIONAL("tasn1")
  ADD_OSQUERY_LINK_ADDITIONAL("p11-kit")
  ADD_OSQUERY_LINK_ADDITIONAL("pthread")
  ADD_OSQUERY_LINK_ADDITIONAL("sasl2")
  ADD_OSQUERY_LINK_ADDITIONAL("db-5.1")
  ADD_OSQUERY_LINK_ADDITIONAL("pq")
  ADD_OSQUERY_LINK_ADDITIONAL("ldap_r")
  ADD_OSQUERY_LINK_ADDITIONAL("mysqlclient")
endif()


file(GLOB OSQUERY_LOGGER_TESTS "tests/*.cpp")
ADD_OSQUERY_TEST(TRUE ${OSQUERY_LOGGER_TESTS})

# Keep the logger testing in the additional to test filesystem logging.
# There is a significant difference between the Glog-backed filesystem plugin
# and other, which use a Glog sink. They must be tested in tandem.
file(GLOB OSQUERY_LOGGER_PLUGIN_TESTS "plugins/tests/*.cpp")
ADD_OSQUERY_TEST(FALSE ${OSQUERY_LOGGER_PLUGIN_TESTS})
